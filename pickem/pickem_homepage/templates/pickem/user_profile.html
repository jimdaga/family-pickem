{% extends 'pickem/base.html' %}
{% load static %}
{% load pickem_homepage_extras %}

{% block mobile_title %}
    <div class="mobile-subtitle">
        <i class="fas fa-user-circle mr-2"></i>{{ profile_user.first_name|default:profile_user.username }}'s Profile
    </div>
{% endblock %}

{% block content %}
    <!-- Hero Profile Section -->
    <div class="relative text-center mb-6 px-4 py-8 lg:py-12 overflow-hidden bg-gradient-to-br from-slate-100 via-blue-200 to-indigo-200 dark:from-blue-600/30 dark:via-purple-600/20 dark:to-red-600/30 border-b-2 border-blue-600 dark:border-blue-500/40 shadow-xl">
        <!-- Subtle background pattern -->
        <div class="absolute inset-0 opacity-20 dark:opacity-5 pointer-events-none"></div>

        <!-- Content -->
        <div class="relative z-10">
            <!-- Profile Avatar -->
            <div class="relative inline-block mb-4">
                <img src="{{ profile_user.socialaccount_set.all.0.get_avatar_url }}"
                     alt="Profile picture"
                     class="w-32 h-32 rounded-full border-4 border-primary shadow-lg">
                <div class="absolute bottom-2 right-2 w-4 h-4 bg-green-500 border-2 border-white dark:border-surface rounded-full"></div>
            </div>

            <!-- User Name -->
            <h1 class="text-3xl lg:text-5xl font-black tracking-tight mb-2"
                style="font-family: 'Urbanist', sans-serif; text-transform: uppercase; letter-spacing: -0.02em; color: white; -webkit-text-stroke: 3px #FF6B1A; paint-order: stroke fill;">
                {{ profile_user.first_name|default:profile_user.username }} {{ profile_user.last_name }}
            </h1>

            <!-- Tagline -->
            {% if user_profile.tagline %}
            <p class="text-base lg:text-xl text-gray-700 dark:text-text-secondary font-medium italic mb-3">
                {{ user_profile.tagline }}
            </p>
            {% endif %}

            <!-- Favorite Team Badge -->
            {% if stats.favorite_team %}
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-primary/10 dark:bg-primary/20 rounded-full">
                {% if stats.favorite_team_logo %}
                <img src="{{ stats.favorite_team_logo }}" alt="{{ stats.favorite_team }} logo" class="w-6 h-6 object-contain">
                {% endif %}
                <span class="font-semibold text-text-dark dark:text-white">{{ stats.favorite_team }} Fan</span>
            </div>
            {% endif %}
        </div>
    </div>

<div class="max-w-7xl mx-auto px-6 py-6">
    {% if is_own_profile %}
    <div class="flex justify-center mb-6">
        <a href="{% url 'profile' %}" class="px-6 py-2.5 rounded-xl border-2 border-primary text-primary hover:bg-primary hover:text-white font-semibold transition-colors flex items-center gap-2">
            <i class="fas fa-cog"></i>Settings
        </a>
    </div>
    {% endif %}

    <!-- Season Achievement Highlights -->
    {% if stats.seasons_won > 0 or stats.weeks_won_current_season > 0 %}
    <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-border-light dark:border-border-subtle">
            <h3 class="text-lg font-bold text-text-dark dark:text-white flex items-center gap-2">
                <i class="fas fa-trophy text-primary"></i>
                Achievements
            </h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                {% if stats.seasons_won > 0 %}
                <div class="flex items-center gap-4 p-4 rounded-xl bg-gradient-to-br from-yellow-400 to-yellow-500 text-gray-900">
                    <i class="fas fa-crown text-3xl"></i>
                    <div class="flex-1">
                        <div class="font-semibold">{{ stats.seasons_won }} Season{{ stats.seasons_won|pluralize }} Won</div>
                    </div>
                </div>
                {% endif %}

                {% if stats.weeks_won_current_season > 0 %}
                <div class="flex items-center gap-4 p-4 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 text-gray-900">
                    <i class="fas fa-calendar-check text-3xl"></i>
                    <div class="flex-1">
                        <div class="font-semibold">{{ stats.weeks_won_current_season }} Week{{ stats.weeks_won_current_season|pluralize }} Won This Season</div>
                    </div>
                </div>
                {% endif %}

                {% if stats.perfect_weeks > 0 %}
                <div class="flex items-center gap-4 p-4 rounded-xl bg-gradient-to-br from-red-500 to-red-600 text-white">
                    <i class="fas fa-bullseye text-3xl"></i>
                    <div class="flex-1">
                        <div class="font-semibold">{{ stats.perfect_weeks }} Perfect Week{{ stats.perfect_weeks|pluralize }}</div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}


    <!-- Key Performance Metrics with Visual Indicators -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <!-- Accuracy Gauge -->
        <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden p-6">
            <h4 class="text-sm font-bold text-text-dark dark:text-white mb-4 flex items-center gap-2">
                <i class="fas fa-bullseye text-primary"></i>
                Season Accuracy
            </h4>
            <div class="relative w-48 h-48 mx-auto">
                <canvas id="accuracyGauge"></canvas>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center">
                        <div class="text-4xl font-black text-text-dark dark:text-white">{{ stats.pick_accuracy_current }}%</div>
                        <div class="text-xs text-text-secondary-light dark:text-text-secondary uppercase">Accuracy</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Points Progress -->
        <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden p-6">
            <h4 class="text-sm font-bold text-text-dark dark:text-white mb-4 flex items-center gap-2">
                <i class="fas fa-star text-primary"></i>
                Season Progress
            </h4>
            <div class="relative w-48 h-48 mx-auto">
                <canvas id="pointsGauge"></canvas>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center">
                        <div class="text-4xl font-black text-text-dark dark:text-white">{{ stats.current_season_points }}</div>
                        <div class="text-xs text-text-secondary-light dark:text-text-secondary uppercase">Points</div>
                        <div class="text-sm font-bold text-yellow-600 dark:text-yellow-400 mt-1">Rank #{{ stats.current_season_rank }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Streaks & Highlights -->
        <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden p-6">
            <h4 class="text-sm font-bold text-text-dark dark:text-white mb-4 flex items-center gap-2">
                <i class="fas fa-fire text-primary"></i>
                Streaks & Highlights
            </h4>
            <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-orange-500/10 to-red-500/10 dark:from-orange-500/20 dark:to-red-500/20 rounded-xl border border-orange-500/30">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-fire text-white"></i>
                        </div>
                        <div>
                            <div class="text-xs text-text-secondary-light dark:text-text-secondary uppercase">Current Streak</div>
                            <div class="text-lg font-black text-text-dark dark:text-white">0 weeks</div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-yellow-500/10 to-amber-500/10 dark:from-yellow-500/20 dark:to-amber-500/20 rounded-xl border border-yellow-500/30">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-yellow-500 to-amber-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-trophy text-white"></i>
                        </div>
                        <div>
                            <div class="text-xs text-text-secondary-light dark:text-text-secondary uppercase">Weeks Won</div>
                            <div class="text-lg font-black text-text-dark dark:text-white">{{ stats.weeks_won_current_season }}</div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-500/10 to-emerald-500/10 dark:from-green-500/20 dark:to-emerald-500/20 rounded-xl border border-green-500/30">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-star text-white"></i>
                        </div>
                        <div>
                            <div class="text-xs text-text-secondary-light dark:text-text-secondary uppercase">Perfect Weeks</div>
                            <div class="text-lg font-black text-text-dark dark:text-white">{{ stats.perfect_weeks|default:0 }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Performance Analysis -->
    <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-border-light dark:border-border-subtle">
            <h3 class="text-lg font-bold text-text-dark dark:text-white flex items-center gap-2">
                <i class="fas fa-chart-line text-primary"></i>
                Performance Analysis
            </h3>
        </div>
        <div class="p-6">

            <!-- Current Season Stats -->
            <div class="mb-6">
                <div class="flex items-center justify-between flex-wrap gap-2 mb-4">
                    <h6 class="text-lg font-semibold text-text-dark dark:text-white flex items-center gap-2">
                        <i class="fas fa-calendar-alt text-primary"></i>Current Season ({{ gameseason_display }})
                    </h6>
                    {% if stats.pick_accuracy_current >= 70 %}
                        <span class="inline-flex items-center gap-1 px-3 py-1 bg-secondary-light/20 dark:bg-secondary/20 text-secondary-light dark:text-secondary rounded-lg text-sm font-semibold">
                            <i class="fas fa-arrow-up"></i> Hot Streak
                        </span>
                    {% elif stats.pick_accuracy_current >= 50 %}
                        <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-500/20 text-blue-600 dark:text-blue-400 rounded-lg text-sm font-semibold">
                            <i class="fas fa-equals"></i> Steady
                        </span>
                    {% else %}
                        <span class="inline-flex items-center gap-1 px-3 py-1 bg-yellow-500/20 text-yellow-600 dark:text-yellow-400 rounded-lg text-sm font-semibold">
                            <i class="fas fa-arrow-down"></i> Improving
                        </span>
                    {% endif %}
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div class="p-4 bg-primary/10 dark:bg-primary/20 rounded-xl border border-primary/30">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Points</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.current_season_points }}</div>
                    </div>
                    <div class="p-4 bg-yellow-500/20 border-yellow-500/30 rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Current Rank</div>
                        <div class="text-2xl font-black text-yellow-600 dark:text-yellow-400">#{{ stats.current_season_rank }}</div>
                    </div>
                    <div class="p-4 bg-primary/10 dark:bg-primary/20 rounded-xl border border-primary/30">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Pick Accuracy</div>
                        <div class="flex items-baseline justify-between">
                            <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.pick_accuracy_current }}%</div>
                            {% if stats.years_playing > 1 %}
                            <div class="text-lg">
                                {% if stats.pick_accuracy_current >= stats.pick_accuracy_lifetime %}
                                    <i class="fas fa-arrow-up text-secondary-light dark:text-secondary"></i>
                                {% else %}
                                    <i class="fas fa-arrow-down text-red-600 dark:text-red-400"></i>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Correct Picks</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.correct_picks|floatformat:0 }}</div>
                    </div>
                    <div class="p-4 {% if user_stats_obj.missedPicksSeason > 0 %}bg-red-500/10 dark:bg-red-600/20 border-red-500/30{% else %}bg-surface-light dark:bg-surface-hover border-border-light dark:border-border-subtle{% endif %} rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Missed Picks</div>
                        <div class="text-2xl font-black {% if user_stats_obj.missedPicksSeason > 0 %}text-red-600 dark:text-red-400{% else %}text-text-dark dark:text-white{% endif %} flex items-center gap-2">
                            {{ user_stats_obj.missedPicksSeason|default:0 }}
                            {% if user_stats_obj.missedPicksSeason > 0 %}
                                <i class="fas fa-exclamation-triangle text-base"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 {% if stats.weeks_won_current_season > 0 %}bg-yellow-500/20 border-yellow-500/30{% else %}bg-surface-light dark:bg-surface-hover border-border-light dark:border-border-subtle{% endif %} rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Weeks Won</div>
                        <div class="text-2xl font-black {% if stats.weeks_won_current_season > 0 %}text-yellow-600 dark:text-yellow-400{% else %}text-text-dark dark:text-white{% endif %} flex items-center gap-2">
                            {{ stats.weeks_won_current_season }}
                            {% if stats.weeks_won_current_season > 0 %}
                                <i class="fas fa-trophy text-base"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 {% if stats.perfect_weeks > 0 %}bg-secondary-light/20 dark:bg-secondary/20 border-secondary-light/30 dark:border-secondary/30{% else %}bg-surface-light dark:bg-surface-hover border-border-light dark:border-border-subtle{% endif %} rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Perfect Weeks</div>
                        <div class="text-2xl font-black {% if stats.perfect_weeks > 0 %}text-secondary-light dark:text-secondary{% else %}text-text-dark dark:text-white{% endif %} flex items-center gap-2">
                            {{ stats.perfect_weeks|default:0 }}
                            {% if stats.perfect_weeks > 0 %}
                                <i class="fas fa-star text-base"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Most Picked</div>
                        <div class="flex items-center justify-center h-10">
                            {% if user_stats_obj.mostPickedSeason %}
                                {% with user_stats_obj.mostPickedSeason|lookuplogo as logo_url %}
                                    <img src="{{ logo_url.teamLogo|default:'/static/images/nfl.svg' }}" alt="{{ user_stats_obj.mostPickedSeason }} team logo" class="w-12 h-12 object-contain">
                                {% endwith %}
                            {% else %}
                                <span class="text-text-secondary-light dark:text-text-secondary">N/A</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Least Picked</div>
                        <div class="flex items-center justify-center h-10">
                            {% if user_stats_obj.leastPickedSeason %}
                                {% with user_stats_obj.leastPickedSeason|lookuplogo as logo_url %}
                                    <img src="{{ logo_url.teamLogo|default:'/static/images/nfl.svg' }}" alt="{{ user_stats_obj.leastPickedSeason }} team logo" class="w-12 h-12 object-contain">
                                {% endwith %}
                            {% else %}
                                <span class="text-text-secondary-light dark:text-text-secondary">N/A</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lifetime Stats -->
            {% if stats.years_playing > 1 %}
            <div>
                <div class="flex items-center justify-between flex-wrap gap-2 mb-4">
                    <h6 class="text-lg font-semibold text-text-dark dark:text-white flex items-center gap-2">
                        <i class="fas fa-history text-secondary-light dark:text-secondary"></i>Lifetime Performance
                    </h6>
                    {% if stats.seasons_won > 0 %}
                        <span class="inline-flex items-center gap-1 px-3 py-1 bg-purple-600/20 text-purple-700 dark:text-purple-400 rounded-lg text-sm font-semibold">
                            <i class="fas fa-crown"></i> Champion
                        </span>
                    {% endif %}
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Years Playing</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.years_playing }}</div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Total Points</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.total_lifetime_points|floatformat:0 }}</div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Best Season</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.best_season_points }}</div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Best Rank</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">#{{ stats.best_rank|default:"--" }}</div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Pick Accuracy</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.pick_accuracy_lifetime }}%</div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Total Correct</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ user_stats_obj.correctPickTotalTotal|default:0 }}</div>
                    </div>
                    <div class="p-4 {% if user_stats_obj.missedPicksTotal > 0 %}bg-red-500/10 dark:bg-red-600/20 border-red-500/30{% else %}bg-surface-light dark:bg-surface-hover border-border-light dark:border-border-subtle{% endif %} rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Total Missed</div>
                        <div class="text-2xl font-black {% if user_stats_obj.missedPicksTotal > 0 %}text-red-600 dark:text-red-400{% else %}text-text-dark dark:text-white{% endif %} flex items-center gap-2">
                            {{ user_stats_obj.missedPicksTotal|default:0 }}
                            {% if user_stats_obj.missedPicksTotal > 0 %}
                                <i class="fas fa-exclamation-triangle text-base"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Weeks Won</div>
                        <div class="text-2xl font-black text-text-dark dark:text-white">{{ stats.weeks_won_total }}</div>
                    </div>
                    <div class="p-4 {% if user_stats_obj.perfectWeeksTotal > 0 %}bg-secondary-light/20 dark:bg-secondary/20 border-secondary-light/30 dark:border-secondary/30{% else %}bg-surface-light dark:bg-surface-hover border-border-light dark:border-border-subtle{% endif %} rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Perfect Weeks</div>
                        <div class="text-2xl font-black {% if user_stats_obj.perfectWeeksTotal > 0 %}text-secondary-light dark:text-secondary{% else %}text-text-dark dark:text-white{% endif %} flex items-center gap-2">
                            {{ user_stats_obj.perfectWeeksTotal|default:0 }}
                            {% if user_stats_obj.perfectWeeksTotal > 0 %}
                                <i class="fas fa-star text-base"></i>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Most Picked</div>
                        <div class="flex items-center justify-center h-10">
                            {% if user_stats_obj.mostPickedTotal %}
                                {% with user_stats_obj.mostPickedTotal|lookuplogo as logo_url %}
                                    <img src="{{ logo_url.teamLogo|default:'/static/images/nfl.svg' }}" alt="{{ user_stats_obj.mostPickedTotal }} team logo" class="w-12 h-12 object-contain">
                                {% endwith %}
                            {% else %}
                                <span class="text-text-secondary-light dark:text-text-secondary">N/A</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 bg-surface-light dark:bg-surface-hover rounded-xl border border-border-light dark:border-border-subtle">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Least Picked</div>
                        <div class="flex items-center justify-center h-10">
                            {% if user_stats_obj.leastPickedTotal %}
                                {% with user_stats_obj.leastPickedTotal|lookuplogo as logo_url %}
                                    <img src="{{ logo_url.teamLogo|default:'/static/images/nfl.svg' }}" alt="{{ user_stats_obj.leastPickedTotal }} team logo" class="w-12 h-12 object-contain">
                                {% endwith %}
                            {% else %}
                                <span class="text-text-secondary-light dark:text-text-secondary">N/A</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="p-4 {% if stats.seasons_won > 0 %}bg-purple-600/20 border-purple-600/30{% else %}bg-surface-light dark:bg-surface-hover border-border-light dark:border-border-subtle{% endif %} rounded-xl border">
                        <div class="text-xs uppercase tracking-wide text-text-secondary-light dark:text-text-secondary mb-1">Seasons Won</div>
                        <div class="text-2xl font-black {% if stats.seasons_won > 0 %}text-purple-700 dark:text-purple-400{% else %}text-text-dark dark:text-white{% endif %} flex items-center gap-2">
                            {% if stats.seasons_won > 0 %}
                                <i class="fas fa-trophy"></i>
                                {{ stats.seasons_won }}
                            {% else %}
                                0
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Activity Summary -->
    <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-border-light dark:border-border-subtle">
            <h3 class="text-lg font-bold text-text-dark dark:text-white flex items-center gap-2">
                <i class="fas fa-chart-pie text-primary"></i>
                Activity Summary
            </h3>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                <div class="flex items-center gap-6 p-6 bg-gradient-to-br from-surface-light to-white dark:from-surface-hover dark:to-surface rounded-2xl border border-border-light dark:border-border-subtle hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-700 rounded-xl flex items-center justify-center text-white text-xl flex-shrink-0">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="flex items-baseline gap-3 flex-1">
                        <span class="text-3xl font-black text-text-dark dark:text-white">{{ posts_count }}</span>
                        <span class="text-lg font-semibold text-text-secondary-light dark:text-text-secondary">Message Board Post{{ posts_count|pluralize }}</span>
                    </div>
                </div>

                <div class="flex items-center gap-6 p-6 bg-gradient-to-br from-surface-light to-white dark:from-surface-hover dark:to-surface rounded-2xl border border-border-light dark:border-border-subtle hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-700 rounded-xl flex items-center justify-center text-white text-xl flex-shrink-0">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="flex items-baseline gap-3 flex-1">
                        <span class="text-3xl font-black text-text-dark dark:text-white">{{ stats.correct_picks|floatformat:0 }}</span>
                        <span class="text-lg font-semibold text-text-secondary-light dark:text-text-secondary">Correct Pick{{ stats.correct_picks|pluralize }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Pick Distribution Chart -->
    {% if team_chart_data and team_chart_labels %}
    <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle overflow-hidden mb-6">
        <div class="px-6 py-4 border-b border-border-light dark:border-border-subtle">
            <h3 class="text-lg font-bold text-text-dark dark:text-white flex items-center gap-2">
                <i class="fas fa-chart-pie text-primary"></i>
                Team Pick Distribution ({{ gameseason_display }})
            </h3>
        </div>
        <div class="p-6">
            <div class="relative h-96 w-full max-w-xl mx-auto bg-white/5 dark:bg-black/10 backdrop-blur-md rounded-3xl border border-white/20 dark:border-white/10 p-8 shadow-xl">
                <canvas id="teamPickChart" width="400" height="400"></canvas>
            </div>

            <div class="mt-6 bg-white/5 dark:bg-black/10 backdrop-blur-md rounded-2xl border border-white/20 dark:border-white/10 p-6 shadow-lg">
                <div class="text-center">
                    <span class="block text-sm font-bold uppercase tracking-wider text-text-secondary-light dark:text-text-secondary mb-3">Most Picked:</span>
                    <div class="flex items-center justify-center gap-2">
                        {% if most_picked_teams %}
                            {% for team in most_picked_teams %}
                                {% with team.slug|lookuplogo as logo_url %}
                                <img src="{{ logo_url.teamLogo|default:'/static/images/nfl.svg' }}"
                                     alt="{{ team.label }} logo"
                                     class="w-10 h-10 object-contain drop-shadow-lg"
                                     onerror="this.src='/static/images/nfl.svg'">
                                {% endwith %}
                            {% endfor %}
                        {% else %}
                            <img src="/static/images/nfl.svg"
                                 alt="No picks yet"
                                 class="w-10 h-10 object-contain drop-shadow-lg">
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- No Stats Message -->
    {% if stats.years_playing == 0 %}
    <div class="bg-surface-light dark:bg-surface rounded-2xl shadow-card border border-border-light dark:border-border-subtle p-12 text-center">
        <i class="fas fa-chart-line text-6xl text-text-secondary-light dark:text-text-secondary mb-4"></i>
        <h4 class="text-text-secondary-light dark:text-text-secondary text-xl font-semibold mb-2">{{ profile_user.first_name|default:profile_user.username }} hasn't started playing yet!</h4>
        <p class="text-text-secondary-light dark:text-text-secondary">Come back after they've submitted some picks to see their stats.</p>
    </div>
    {% endif %}
</div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <script>
    {% if team_chart_data and team_chart_labels %}
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('teamPickChart').getContext('2d');

        // Check if dark mode is active
        const isDarkMode = document.documentElement.classList.contains('dark');

        // Team data for custom legend
        const teamSlugs = {{ team_chart_slugs|safe }};
        const teamLabels = {{ team_chart_labels|safe }};
        const teamData = {{ team_chart_data|safe }};
        const teamColors = {{ team_chart_colors|safe }};
        const teamLogos = {{ team_chart_logos|safe }};

        const teamPickChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: {{ team_chart_labels|safe }},
                datasets: [{
                    data: {{ team_chart_data|safe }},
                    backgroundColor: {{ team_chart_colors|safe }},
                    borderColor: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.8)',
                    borderWidth: 3,
                    hoverOffset: 8,
                    cutout: '60%',
                    radius: '85%'
                }]
            },
            plugins: [ChartDataLabels],
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                elements: {
                    arc: {
                        borderJoinStyle: 'round'
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    datalabels: {
                        color: '#ffffff',
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        formatter: function(value, context) {
                            if (value >= 2) {
                                return context.chart.data.labels[context.dataIndex];
                            }
                            return '';
                        },
                        textAlign: 'center',
                        anchor: 'center',
                        align: 'center',
                        textStrokeColor: 'rgba(0, 0, 0, 0.8)',
                        textStrokeWidth: 2
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                return ' ' + label + ': ' + value + '%';
                            }
                        },
                        backgroundColor: isDarkMode ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 255, 255, 0.95)',
                        titleColor: isDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(0, 0, 0, 0.9)',
                        bodyColor: isDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)',
                        borderColor: isDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)',
                        borderWidth: 1,
                        cornerRadius: 12,
                        padding: 12,
                        titleFont: {
                            size: 14,
                            weight: '600'
                        },
                        bodyFont: {
                            size: 13
                        },
                        filter: function(tooltipItem) {
                            return tooltipItem.parsed > 0;
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 1500,
                    easing: 'easeInOutQuart'
                }
            }
        });

        // Update chart when theme changes
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const newIsDarkMode = document.documentElement.classList.contains('dark');

                    // Update border colors
                    teamPickChart.data.datasets[0].borderColor = newIsDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(255, 255, 255, 0.8)';

                    // Update tooltip colors
                    teamPickChart.options.plugins.tooltip.backgroundColor = newIsDarkMode ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 255, 255, 0.95)';
                    teamPickChart.options.plugins.tooltip.titleColor = newIsDarkMode ? 'rgba(255, 255, 255, 0.9)' : 'rgba(0, 0, 0, 0.9)';
                    teamPickChart.options.plugins.tooltip.bodyColor = newIsDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';
                    teamPickChart.options.plugins.tooltip.borderColor = newIsDarkMode ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.1)';

                    teamPickChart.update('none');
                }
            });
        });

        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class']
        });
    });
    {% endif %}

    // Accuracy Gauge Chart
    const accuracyCtx = document.getElementById('accuracyGauge');
    if (accuracyCtx) {
        const isDarkMode = document.documentElement.classList.contains('dark');
        const accuracyValue = {{ stats.pick_accuracy_current }};

        new Chart(accuracyCtx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [accuracyValue, 100 - accuracyValue],
                    backgroundColor: [
                        accuracyValue >= 70 ? '#10b981' : accuracyValue >= 50 ? '#3b82f6' : '#f59e0b',
                        isDarkMode ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)'
                    ],
                    borderWidth: 0,
                    cutout: '75%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });
    }

    // Points Gauge Chart
    const pointsCtx = document.getElementById('pointsGauge');
    if (pointsCtx) {
        const isDarkMode = document.documentElement.classList.contains('dark');
        const currentPoints = {{ stats.current_season_points }};
        const maxPoints = 200; // Estimate based on max possible points
        const pointsPercent = Math.min((currentPoints / maxPoints) * 100, 100);

        new Chart(pointsCtx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [pointsPercent, 100 - pointsPercent],
                    backgroundColor: [
                        '#f59e0b',
                        isDarkMode ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)'
                    ],
                    borderWidth: 0,
                    cutout: '75%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });
    }
    </script>
{% endblock %}
